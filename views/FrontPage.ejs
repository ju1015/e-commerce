<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MyShop E-Commerce</title>
<style>
  * { margin:0; padding:0; box-sizing:border-box; font-family:Arial,sans-serif; }
  body { background: linear-gradient(to bottom,#1e3c72,#2a5298); color:#fff; overflow-x:hidden; min-height:100vh; position:relative; }

  /* Clouds animation */
  .clouds { position: fixed; bottom:-200px; left:0; width:100%; height:200%; pointer-events:none; overflow:hidden; z-index:-1; }
  .cloud { position:absolute; bottom:-150px; background:#fff; border-radius:50%; opacity:0.6; filter:blur(3px); animation: floatUp linear infinite; }
  .cloud:nth-child(1){ width:200px;height:80px;left:10%;animation-duration:60s;}
  .cloud:nth-child(2){ width:150px;height:60px;left:40%;animation-duration:80s;}
  .cloud:nth-child(3){ width:250px;height:90px;left:70%;animation-duration:100s;}
  @keyframes floatUp{ from{transform:translateY(0);} to{transform:translateY(-120vh);} }

  /* Navbar */
  .navbar { display:flex; justify-content:flex-start; align-items:center; padding:1rem 2rem; background:rgba(0,0,0,0.7); color:#fff; gap:40px; position:sticky; top:0; z-index:100; backdrop-filter:blur(5px);}
  .navbar h1{ font-size:1.5rem; margin-right:50px; color:#ffc107; }
  .navbar ul{ list-style:none; display:flex; gap:40px; }
  .navbar ul li form{ display:inline; }
  .nav-btn{ background:none; border:none; color:#fff; font-weight:bold; cursor:pointer; font-size:1rem; transition:0.3s; }
  .nav-btn:hover{ color:#ffc107; }
  .profile{ margin-left:auto; display:flex; align-items:center; gap:10px; cursor:pointer; }
  .profile img{ width:40px;height:40px; border-radius:50%; border:2px solid #fff; }
  .profile span{ color:#ffc107; font-weight:bold; }

  /* Hero Section */
  .hero{ text-align:center; padding:4rem 2rem; background:linear-gradient(135deg,#667eea,#764ba2); color:#fff; box-shadow:0 10px 25px rgba(0,0,0,0.3); }
  .hero h2{ font-size:2.5rem; margin-bottom:1rem; display:inline-block; animation:wave 3s ease-in-out infinite;}
  .hero p{ font-size:1.2rem; margin-bottom:2rem; }
  @keyframes wave{ 0%,100%{ transform:rotate(0deg);} 25%{ transform:rotate(2deg);} 50%{ transform:rotate(-2deg);} 75%{ transform:rotate(1deg);} }
  .hero-buttons{ display:flex; justify-content:center; gap:20px; }
  .hero button{ padding:12px 20px; background:#ffc107; border:none; border-radius:8px; font-size:1rem; cursor:pointer; transition:0.3s; }
  .hero button:hover{ background:#e0a800; transform:scale(1.05); }
  .sell-btn{ background:#28a745; } .sell-btn:hover{ background:#218838; }

  /* Products Section */
  .products{ padding:2rem; position:relative; z-index:1; overflow:hidden; }
  .products h2{ text-align:center; margin-bottom:2rem; font-size:2rem; animation:wave 2.5s infinite; color:#ffc107;}
  .product-track-container{ overflow:hidden; position:relative; width:100%; }
  .product-track{ display:flex; gap:20px; position:relative; }
  .product-track > div{ flex-shrink:0; }

  .product-card{ min-width:180px; max-width:200px; background:rgba(28,28,28,0.9); border-radius:12px; padding:1rem; text-align:center; box-shadow:0 3px 12px rgba(0,0,0,0.4); transition: transform 0.3s, box-shadow 0.3s; cursor:pointer; }
  .product-card:hover{ transform:translateY(-8px) scale(1.05); box-shadow:0 10px 25px rgba(0,0,0,0.6); }
  .product-card img{ max-width:100%; height:140px; object-fit:cover; border-radius:8px; margin-bottom:0.6rem; }
  .product-card h3{ font-size:1rem; margin-bottom:0.3rem; color:#ffc107; }
  .product-card p{ font-size:0.9rem; margin-bottom:0.6rem; color:#ccc; }

  /* Modal */
  .modal{ position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:flex; justify-content:center; align-items:center; opacity:0; pointer-events:none; transition:opacity 0.3s; z-index:200;}
  .modal.active{ opacity:1; pointer-events:auto; }
  .modal-content{ background:rgba(28,28,28,0.95); padding:2rem; border-radius:12px; max-width:400px; width:90%; text-align:center; animation:fadeIn 0.3s; }
  .modal-content img{ width:100%; height:200px; object-fit:cover; border-radius:8px; margin-bottom:1rem; }
  .modal-content h3{ font-size:1.5rem; color:#ffc107; margin-bottom:0.5rem; }
  .modal-content p{ color:#ccc; margin-bottom:1rem; }
  .modal-content button{ padding:10px 20px; background:#28a745; border:none; border-radius:6px; color:#fff; cursor:pointer; transition:0.3s; }
  .modal-content button:hover{ background:#218838; transform:scale(1.05); }

  @keyframes fadeIn{ from{ transform:scale(0.9); opacity:0;} to{ transform:scale(1); opacity:1; } }

  /* Footer */
  .footer{ background:rgba(0,0,0,0.8); color:#fff; text-align:center; padding:1rem; margin-top:2rem; backdrop-filter:blur(4px); }
</style>
</head>
<body>

<!-- Clouds -->
<div class="clouds">
  <div class="cloud"></div>
  <div class="cloud"></div>
  <div class="cloud"></div>
</div>

<!-- Navbar -->
<div class="navbar">
  <h1>MyShop</h1>
  <ul>
    <li><form action="/profile"><button type="submit" class="nav-btn">Home</button></form></li>
    <li><form action="/shopNow" method="POST"><button type="submit" class="nav-btn">Products</button></form></li>
    <li><form action="/cart"><button type="submit" class="nav-btn">Cart <% if(cart && cart.items.length>0){ %>(<%= cart.items.length %>) <% } %></button></form></li>
    <li><form action="/logout" method="POST"><button type="submit" class="nav-btn">Logout</button></form></li>
  </ul>
  <div class="profile">
    <img src="https://www.planetware.com/wpimages/2020/01/india-in-pictures-beautiful-places-to-photograph-taj-mahal.jpg" alt="Profile">
    <span>Hi, <%= user.username %></span>
  </div>
</div>

<!-- Hero -->
<div class="hero">
  <h2>Welcome to MyShop</h2>
  <p>Find the best deals on top products!</p>
  <div class="hero-buttons">
    <form action="/shopNow" method="POST" style="display:inline;"><button type="submit" class="hero-btn">Shop Now</button></form>
    <form action="/sellProducts" style="display:inline;"><button type="submit" class="hero-btn sell-btn">Sell Products</button></form>
  </div>
</div>

<!-- Products Section -->
<div class="products">
  <h2>Featured Products</h2>
  <% if(products.length>0){ %>
  <div class="product-track-container">
    <div class="product-track" id="productTrack">
      <% products.forEach(product => { %>
        <div 
            class="product-card" 
            data-id="<%= product._id %>" 
            data-name="<%= product.name %>" 
            data-image="/uploads/<%= product.image %>" 
            data-price="<%= product.price %>" 
            data-description="<%= product.description %>" 
            onclick="showModal(this)">
            <img src="/uploads/<%= product.image %>" alt="<%= product.name %>">
            <h3><%= product.name %></h3>
            <p>$<%= product.price %></p>
          </div>
      <% }) %>
      <% products.forEach(product => { %>
        <div 
          class="product-card" 
          data-id="<%= product._id %>" 
          data-name="<%= product.name %>" 
          data-image="/uploads/<%= product.image %>" 
          data-price="<%= product.price %>" 
          data-description="<%= product.description %>" 
          onclick="showModal(this)">
          <img src="/uploads/<%= product.image %>" alt="<%= product.name %>">
          <h3><%= product.name %></h3>
          <p>$<%= product.price %></p>
        </div>
      <% }) %>
    </div>
  </div>
  <% } else { %>
    <p style="text-align:center; color:#ccc; font-size:18px;">No products available right now. Please check back later!</p>
  <% } %>
</div>

<!-- Modal -->
<div class="modal" id="productModal" onclick="closeModal(event)">
  <div class="modal-content" id="modalContent">
    <img src="" id="modalImg" alt="">
    <h3 id="modalName"></h3>
    <p id="modalDescription"></p>
    <p id="modalPrice"></p>
    <form id="modalForm" action='/cart/<%= products._id %>'  method="POST" ><button type="submit">Add Cart</button></form>
  </div>
</div>

<!-- Footer -->
<div class="footer">
  <p>&copy; 2025 MyShop. All rights reserved.</p>
</div>

<script>
  // Modal
  function showModal(card){
  document.getElementById('modalImg').src = card.dataset.image;
  document.getElementById('modalName').innerText = card.dataset.name;
  document.getElementById('modalDescription').innerText = card.dataset.description;
  document.getElementById('modalPrice').innerText = "$" + card.dataset.price;
  
  // âœ… now pass the product _id, not name
  document.getElementById('modalForm').action = "/cart/" + card.dataset.id;
  
  document.getElementById('productModal').classList.add('active');
}

  function closeModal(e){
    if(e.target.id==='productModal'){
      document.getElementById('productModal').classList.remove('active');
    }
  }

  // Smooth circular carousel
  const track = document.getElementById('productTrack');
  let pos = 0;
  const speed = 0.5; // px per frame

  function animateTrack(){
    pos -= speed;
    if(Math.abs(pos) >= track.scrollWidth/2) pos = 0; // loop seamlessly
    track.style.transform = `translateX(${pos}px)`;
    requestAnimationFrame(animateTrack);
  }
  animateTrack();
</script>

</body>
</html>
