<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sell Products - MyShop</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #121212;
        padding: 20px;
        color: #f1f1f1;
        overflow-x: hidden;  /* only block horizontal overflow */
        overflow-y: auto;    /* allow vertical scroll */
        position: relative;
    }


    /* üî• Fire animated background */
    .fire-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(180deg, #ff0000, #ff6a00, #ffcc00, #ff6a00, #ff0000);
        background-size: 200% 200%;
        animation: flames 4s infinite ease-in-out;
        z-index: -1;
        opacity: 0.5;
        filter: blur(60px);
    }

    @keyframes flames {
        0%   { background-position: 50% 100%; }
        25%  { background-position: 60% 80%; }
        50%  { background-position: 50% 60%; }
        75%  { background-position: 40% 80%; }
        100% { background-position: 50% 100%; }
    }

    /* Top buttons */
    .top-buttons {
        position: fixed;
        top: 20px;
        left: 20px;
        display: flex;
        gap: 10px;
        z-index: 1000;
    }

    .nav-btn {
        padding: 8px 14px;
        background: #ff6a00;
        color: #fff;
        font-weight: bold;
        border-radius: 8px;
        text-decoration: none;
        cursor: pointer;
        transition: 0.3s;
        border: none;
    }

    .nav-btn:hover {
        background: #ee0979;
        transform: scale(1.05);
    }

    h1 {
        text-align: center;
        margin-bottom: 20px;
        color: #fff;
    }

    .sell-card {
        background: linear-gradient(135deg, #ff6a00, #ee0979);
        color: #fff;
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 10px 20px rgba(0,0,0,0.4);
        width: 90%;
        max-width: 600px;
        margin: 100px auto 30px auto;
        transition: transform 0.3s, box-shadow 0.3s;
        position: relative;
        z-index: 1;
    }

    .sell-card h3 {
        text-align: center;
        margin-bottom: 1rem;
        font-size: 2rem;
    }

    .sell-card form {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .sell-card input[type="text"],
    .sell-card input[type="number"],
    .sell-card textarea {
        padding: 10px;
        border-radius: 8px;
        border: none;
        font-size: 1rem;
    }

    .sell-card input[type="file"] {
        color: #fff;
    }

    .sell-card img#previewImage {
        width: 100%;
        max-height: 200px;
        object-fit: cover;
        border-radius: 12px;
        display: none;
        margin-bottom: 10px;
    }

    .sell-card button {
        padding: 12px;
        border-radius: 50px;
        font-size: 1rem;
        font-weight: bold;
        border: none;
        cursor: pointer;
        transition: 0.3s;
        color: #ee0979;
        background: #fff;
    }

    .sell-card button:hover {
        background: #ff6a00;
        color: #fff;
        transform: scale(1.05);
    }

    .go-back-btn {
        background: #6c757d;
        color: #fff;
    }
    .go-back-btn:hover {
        background: #5a6268;
    }

    .products {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        margin-top: 30px;
        position: relative;
        z-index: 1;
    }

    .product-card {
        background: #1e1e1e;
        border-radius: 12px;
        box-shadow: 0 6px 15px rgba(0,0,0,0.6);
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        color: #f1f1f1;
        padding-bottom: 10px;
    }

    /* ‚ú® Hover effect */
    .product-card:hover {
        transform: scale(1.05) rotate(1deg);
        box-shadow: 0 10px 25px rgba(255,106,0,0.7);
    }

    .product-card img {
        width: 100%;
        height: 180px;
        object-fit: cover;
        border-top-left-radius: 12px;
        border-top-right-radius: 12px;
        margin-bottom: 10px;
    }

    .product-card h4 {
        margin: 10px;
        font-size: 1.2rem;
        color: #fff;
    }

    .product-card p {
        margin: 0 10px 10px;
        color: #bbb;
    }

    .product-card .price {
        font-weight: bold;
        color: #ee0979;
        margin: 10px;
    }

    .card-actions {
        display: flex;
        justify-content: space-between;
        padding: 10px;
    }

    .card-actions button {
        flex: 1;
        margin: 0 5px;
        padding: 8px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: 0.3s;
    }

    .edit-btn { background: #ffc107; color: #fff; }
    .edit-btn:hover { background: #e0a800; }

    .delete-btn { background: #dc3545; color: #fff; }
    .delete-btn:hover { background: #c82333; }

    @media (max-width: 1024px) { .products { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 600px) { .products { grid-template-columns: 1fr; } }
</style>
</head>
<body>

<!-- üî• Fire Background Layer -->
<div class="fire-bg"></div>

<!-- Top-left navigation buttons as POST -->
<div class="top-buttons">
    <form action="/profile">
        <button class="nav-btn">üè† Go to Home</button>
    </form>
    <form action="/shopNow" method="POST">
        <button class="nav-btn">üõçÔ∏è Shop Now</button>
    </form>
</div>

<h1>üõí Sell Your Product</h1>

<div class="sell-card">
    <h3 id="formTitle">üíé Add Product</h3>
    <p style="text-align:center;">Reach thousands of customers and grow your business!</p>
    
    <form id="productForm" action="/addProduct" method="POST" enctype="multipart/form-data">
        <input type="hidden" name="productId" id="productId">
        <input type="hidden" name="existingImage" id="existingImage">

        <img id="previewImage" src="" alt="Product Preview">
        <input type="text" id="productName" name="name" placeholder="Product Name" required>
        <textarea id="productDescription" name="description" rows="4" placeholder="Product Description" required></textarea>
        <input type="number" name="price" id="productPrice" placeholder="Price ($)" step="0.01" required>
        <input type="file" id="productImage" name="image" accept="image/*">
        <button type="submit" id="submitBtn">Add Product</button>
        <button type="button" class="go-back-btn" id="goBackBtn" style="display:none;">Go Back</button>
    </form>
</div>

<div class="products" id="productsList">
  <% if (!products || products.length === 0) { %>
      <p style="text-align:center; color:#fff;">You haven't added any products yet.</p>
  <% } else { %>
      <% products.forEach(function(product) { %>
        <div class="product-card" data-id="<%= product._id %>">
          <img src="/uploads/<%= product.image %>" alt="<%= product.name %>">
          <h4><%= product.name %></h4>
          <p><%= product.description %></p>
          <div class="price">$<%= product.price %></div>
          <div class="card-actions">
            <button type="button" class="edit-btn" onclick="editProduct(this)">Edit</button>
            <button type="button" class="delete-btn" onclick="deleteProduct(this)">Delete</button>
          </div>
        </div>
      <% }) %>
  <% } %>
</div>

<script>
let editingCard = null;

function editProduct(button) {
    editingCard = button.closest(".product-card");
    const name = editingCard.querySelector("h4").innerText;
    const description = editingCard.querySelector("p").innerText;
    const price = editingCard.querySelector(".price").innerText.replace("$", "");
    const imageSrc = editingCard.querySelector("img").src;
    const productId = editingCard.dataset.id;

    document.getElementById("formTitle").innerText = "‚úèÔ∏è Edit Product";
    document.getElementById("submitBtn").innerText = "Update Product";
    document.getElementById("goBackBtn").style.display = "inline-block";

    document.getElementById("productName").value = name;
    document.getElementById("productDescription").value = description;
    document.getElementById("productPrice").value = price;
    document.getElementById("previewImage").src = imageSrc;
    document.getElementById("previewImage").style.display = "block";

    document.getElementById("productId").value = productId;
    const filename = imageSrc.split("/").pop();
    document.getElementById("existingImage").value = filename;

    window.scrollTo({ top: 0, behavior: "smooth" });
}

document.getElementById("goBackBtn").addEventListener("click", resetForm);

function resetForm() {
    document.getElementById("productForm").reset();
    document.getElementById("previewImage").style.display = "none";
    document.getElementById("formTitle").innerText = "üíé Add Product";
    document.getElementById("submitBtn").innerText = "Add Product";
    document.getElementById("goBackBtn").style.display = "none";
    editingCard = null;
}

function handleImagePreview(event) {
    const preview = document.getElementById("previewImage");
    const file = event.target.files[0];

    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.src = e.target.result;
            preview.style.display = "block";
        }
        reader.readAsDataURL(file);
    } else {
        preview.src = "";
        preview.style.display = "none";
    }
}

document.getElementById("productImage").addEventListener("change", handleImagePreview);

function deleteProduct(button) {
    const card = button.closest(".product-card");
    const productId = card.dataset.id;

    if (confirm("Are you sure you want to delete this product?")) {
        fetch(`/deleteProduct/${productId}`, { method: "DELETE" })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    card.remove();
                    if (editingCard === card) resetForm();
                    const productsList = document.getElementById("productsList");
                    if (productsList.querySelectorAll(".product-card").length === 0) {
                        productsList.innerHTML = '';
                        const p = document.createElement('p');
                        p.style.textAlign = "center";
                        p.style.color = "#fff";
                        p.innerText = "You haven't added any products yet.";
                        productsList.appendChild(p);
                    }
                    alert("Product deleted successfully!");
                } else {
                    alert("Failed to delete product.");
                }
            })
            .catch(err => console.error(err));
    }
}
</script>

</body>
</html>
